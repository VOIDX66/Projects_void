<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionar Participación</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Gestionar Participación en Partidos</h1>
        <p class="text-center">Jugador: <strong><%= jugador %></strong></p>
        <table class="table table-bordered table-striped mt-4">
            <thead class="table-dark">
                <tr>
                    <th>Fecha</th>
                    <th>Equipo 1</th>
                    <th>Equipo 2</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                <% partidos.forEach(partido => { %>
                    <tr>
                        <td><%= partido.fecha %></td>
                        <td><%= partido.equipo_1 %></td>
                        <td><%= partido.equipo_2 %></td>
                        <td>
                            <% if (partido.estaEnPartido) { %>
                                <form action="/dar_de_baja_participacion" method="post">
                                    <input type="hidden" name="id_partido" value="<%= partido.id_partido %>">
                                    <p>Estás en el equipo: <%= partido.equipoJugador %></p>
                                    <button type="submit" class="btn btn-danger">
                                        Darme de baja
                                    </button>
                                </form>
                                
                            <% } else { %>
                                <button class="btn btn-success" onclick="agregarme(<%= partido.id_partido %>)">
                                    Agregarse
                                </button>
                            <% } %>
                        </td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
    <button onclick="window.location.href='/';" class="btn btn-secondary mt-3">Volver Atrás</button>

    <script>
        // Función para agregarse al partido
        function agregarme(idPartido) {
            fetch('/agregar_participacion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id_partido: idPartido })
            }).then(response => response.json())
              .then(data => {
                if (data.error) {
                    alert(data.error);  // Mostrar el error en una alerta
                } else {
                    alert(data.message);  // Mostrar el mensaje de éxito en una alerta
                    location.reload();
                }
            }).catch(error => {
                alert('Hubo un problema con la solicitud: ' + error);
            });
        }
    </script>
</body>
</html>
